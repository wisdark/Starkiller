import{_ as l,a as m}from"./GeneralForm-b4ad1aad.js";import{_ as c}from"./InfoViewer-66374b6c.js";import{_ as d,a as h,b as _,c as f}from"./ErrorStateAlert-a4c81cb3.js";import{_ as p}from"./TagViewer-fb73600c.js";import{_ as u}from"./EditPageTop-b6ce2b5e.js";import{n as g,l as w,r as y,m as b,o as $,p as T,s as n,t as v,v as L,k,a as E,b as x,d as N,e as a,f as o,i as C,c as S}from"./index-1a1ed2d6.js";import{_ as I}from"./VSwitch-7481b5df.js";import"./VSelect-8447b5da.js";import"./bypass-module-365707c8.js";import"./bypass-api-473852be.js";import"./credential-module-5bdb810d.js";import"./malleable-module-f0a4685b.js";import"./malleable-api-8b867ade.js";import"./VExpansionPanels-772758bb.js";import"./VItemGroup-d98abd29.js";import"./VExpansionPanelHeader-6964ad73.js";import"./TooltipButton-62ba9662.js";import"./VTooltip-90e9ddba.js";const M={name:"ListenerEdit",components:{TagViewer:p,InfoViewer:c,GeneralForm:l,ErrorStateAlert:d,EditPageTop:u},data(){return{listener:{options:{}},listenerTemplate:{options:{}},selectedTemplate:"",form:{},reset:!0,loading:!1,formPriorities:["Name","Host","Port"],errorState:!1,validationMessage:null,initialLoad:!1,commonStagers:["multi_launcher","multi_macro","windows_csharp_exe","windows_dll","windows_shellcode"]}},computed:{listenerStore(){return w()},listenerTemplateIds(){return this.listenerStore.templateIds},isNew(){return this.$route.name==="listenerNew"},isCopy(){return this.$route.params.copy===!0},mode(){return this.isCopy?"Copy":this.isNew?"New":"View"},canEdit(){return this.isNew||!this.listener.enabled},id(){return this.isCopy?0:this.$route.params.id},copyLink(){return this.id>0?{name:"listenerNew",params:{copy:!0,id:this.id}}:{}},listenerInfo(){if(!this.listenerTemplate)return{};const t=this.listenerTemplate;return{authors:t.authors,description:t.description,comments:t.comments}},listenerOptions(){if(!this.isNew||this.isCopy){const e={};return Object.keys(this.listener.options).forEach(s=>{e[s]={...this.listenerTemplate.options[s]},e[s].value=this.listener.options[s]}),e}const{options:t}=this.listenerTemplate;return t||{}},breads(){return[{text:"Listeners",disabled:!1,to:"/listeners",exact:!0},{text:this.breadcrumbName,disabled:!0,to:"/listeners-edit"}]},breadcrumbName(){return this.isCopy?"New":this.listener.name?this.listener.name:this.id?this.id:"New"}},watch:{selectedTemplate:{async handler(t){const e=await y(t).catch(s=>this.$snack.error(`Error: ${s}`));e&&(this.reset=!1,this.listenerTemplate=e,await this.$nextTick(),this.reset=!0,this.initialLoad=!0)}},id(t){t&&this.getListener(t)}},mounted(){this.listenerStore.getListenerTemplates(),(!this.isNew||this.isCopy)&&this.getListener(this.$route.params.id)},methods:{deleteTag(t){b(this.listener.id,t.id).then(()=>{this.listener.tags=this.listener.tags.filter(e=>e.id!==t.id)}).catch(e=>this.$snack.error(`Error: ${e}`))},updateTag(t){$(this.listener.id,t).then(e=>{const s=this.listener.tags.findIndex(i=>i.id===e.id);this.listener.tags.splice(s,1,e),this.$snack.success("Tag updated")}).catch(e=>this.$snack.error(`Error: ${e}`))},addTag(t){T(this.listener.id,t).then(e=>{this.listener.tags.push(e)}).catch(e=>this.$snack.error(`Error: ${e}`))},async submit(){this.loading||!this.$refs.generalform.$refs.form.validate()||(this.loading=!0,this.id>0?n({...this.listener,options:this.form}).then(()=>{this.$snack.success("Listener updated"),this.loading=!1}).catch(t=>{t.startsWith("[*]")?this.validationMessage=t:this.$snack.error(`Error: ${t}`),this.loading=!1}):v(this.selectedTemplate,this.form).then(({id:t})=>{this.$snack.success("Listener created"),this.loading=!1,this.$router.push({name:"listenerEdit",params:{id:t}})}).catch(t=>{t.startsWith("[*]")?this.validationMessage=t:this.$snack.error(`Error: ${t}`),this.loading=!1}))},async kill(){if(await this.$root.$confirm("Delete",`Are you sure you want to kill listener ${this.form.Name}?`,{color:"red"}))try{await this.listenerStore.killListener(this.id),this.$router.push({name:"listeners"})}catch(t){this.$snack.error(`Error: ${t}`)}},getListener(t){L(t).then(e=>{this.listener=e,this.listener.tags.forEach(s=>{s.color=s.color||"#0E0CDA"}),this.selectedTemplate=e.template}).catch(()=>{this.errorState=!0})},async toggleEnabled(t){if(this.listener.enabled=t,t===!0&&!await this.$root.$confirm("","Re-enabling the listener will also save any unsaved option changes.",{color:"yellow"})){this.listener.enabled=!t;return}try{const e=await n({...this.listener,options:this.form});this.listener=e}catch(e){this.listener.enabled=!t,this.$snack.error(`Error: ${e}`)}}}};var O=function(){var e=this,s=e._self._c;return s("div",[s(u,{attrs:{breads:e.breads,"show-submit":e.initialLoad,"disable-submit":!e.canEdit&&e.initialLoad,"show-copy":e.id>0&&e.initialLoad,"show-delete":e.id>0&&e.initialLoad,"submit-loading":e.loading,"copy-link":e.copyLink,"small-copy":!0,"small-delete":!0},on:{submit:e.submit,delete:e.kill},scopedSlots:e._u([{key:"extra-stuff",fn:function(){return[s("div",{staticClass:"pt-2",staticStyle:{display:"flex","flex-direction":"row"}},[!e.isNew&&e.initialLoad?s(I,{staticClass:"mr-2",attrs:{color:"green",label:"Enabled"},on:{change:e.toggleEnabled},model:{value:e.listener.enabled,callback:function(i){e.$set(e.listener,"enabled",i)},expression:"listener.enabled"}}):e._e(),!e.isNew&&e.initialLoad?s(k,{attrs:{"offset-y":"","open-on-hover":""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:r}){return[s(E,e._g(e._b({staticClass:"mr-5",attrs:{text:"",icon:"",small:""}},"v-btn",r,!1),i),[s(x,[e._v("fa-suitcase-rolling")])],1)]}}],null,!1,265209208)},[s(N,{staticClass:"ml-2 mr-2"},[e._l(e.commonStagers,function(i,r){return s(a,{key:r,attrs:{link:"",to:{name:"stagerNew",query:{template:i,listener:e.listener.name}}}},[s(o,[e._v(" "+e._s(i)+" ")])],1)}),s(C),s(a,{attrs:{link:"",to:{name:"stagerNew"}}},[s(o,[e._v(" Other ")])],1)],2)],1):e._e()],1)]},proxy:!0}])}),s("div",{staticClass:"headers"},[s("h3",[e._v(e._s(e.mode)+" Listener")])]),e.isNew?e._e():s(p,{attrs:{tags:e.listener.tags},on:{"update-tag":e.updateTag,"delete-tag":e.deleteTag,"new-tag":e.addTag}}),e.errorState?s(d,{attrs:{"resource-id":e.id,"resource-type":"listener"}}):s(S,{staticStyle:{padding:"10px"}},[s(c,{staticClass:"info-viewer",attrs:{info:e.listenerInfo}}),s(m,{attrs:{items:e.listenerTemplateIds,loading:!e.reset,dense:"",outlined:"",label:"Type",readonly:!e.canEdit},model:{value:e.selectedTemplate,callback:function(i){e.selectedTemplate=i},expression:"selectedTemplate"}}),e.validationMessage?s(h,{attrs:{prominent:"",type:"warning"}},[s(_,{attrs:{align:"center"}},[s(f,{staticClass:"grow",staticStyle:{"word-wrap":"word-break",width:"500px"}},[e._v(" "+e._s(e.validationMessage)+" ")])],1)],1):e._e(),e.reset?s(l,{ref:"generalform",attrs:{options:e.listenerOptions,priority:e.formPriorities,readonly:!e.canEdit},model:{value:e.form,callback:function(i){e.form=i},expression:"form"}}):e._e()],1)],1)},P=[],V=g(M,O,P,!1,null,null,null,null);const ee=V.exports;export{ee as default};
